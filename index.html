<!DOCTYPE html>
<html>
<head>
  <title>Micro:bit Live Data</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Micro:bit Data</h1>
  <button id="connect">Tilslut Micro:bit</button>
  <pre id="output"></pre>

  <script>
    document.getElementById("connect").addEventListener("click", async () => {
      try {
        const port = await navigator.serial.requestPort();
        await port.open({ baudRate: 115200 });

        const decoder = new TextDecoderStream();
        const reader = port.readable.pipeThrough(decoder).getReader();

        while (true) {
          const { value, done } = await reader.read();
          if (done) break;
          const output = document.getElementById("output");
            output.textContent += value;
            output.scrollTop = output.scrollHeight; 

        }
      
      } catch (err) {
        console.error(err);
      }
    });

    class LineBreakTransformer {
  constructor() {
    this.container = '';
  }

  transform(chunk, controller) {
    this.container += chunk;
    const lines = this.container.split('\n');
    this.container = lines.pop(); // gem sidste halvfÃ¦rdige linje
    lines.forEach(line => controller.enqueue(line));
  }

  flush(controller) {
    controller.enqueue(this.container);
  }
}
  </script>
</body>
</html>
